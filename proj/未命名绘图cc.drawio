<mxfile host="app.diagrams.net" modified="2023-03-13T11:31:48.505Z" agent="5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/110.0.0.0 Safari/537.36" etag="b_smCOg7oBk-a2SBce4y" version="21.0.6" type="github">
  <diagram name="第 1 页" id="AIHpLqUsC8GYLCosSFE9">
    <mxGraphModel dx="1434" dy="796" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="sr0B_SRzAFL80KdLilT3-1" value="&lt;h1&gt;Heading&lt;/h1&gt;&lt;div style=&quot;background-color:#1e1f22;color:#a9b7c6;font-family:&#39;JetBrains Mono&#39;,monospace;font-size:9.8pt;&quot;&gt;&lt;pre&gt;import bisect&lt;br&gt;&lt;span style=&quot;color:#cc7832;&quot;&gt;import &lt;/span&gt;calendar&lt;br&gt;&lt;span style=&quot;color:#cc7832;&quot;&gt;import &lt;/span&gt;os&lt;br&gt;&lt;span style=&quot;color:#cc7832;&quot;&gt;import &lt;/span&gt;sys&lt;br&gt;&lt;span style=&quot;color:#cc7832;&quot;&gt;from &lt;/span&gt;copy &lt;span style=&quot;color:#cc7832;&quot;&gt;import &lt;/span&gt;copy&lt;br&gt;&lt;span style=&quot;color:#cc7832;&quot;&gt;from &lt;/span&gt;datetime &lt;span style=&quot;color:#cc7832;&quot;&gt;import &lt;/span&gt;datetime&lt;br&gt;&lt;span style=&quot;color:#cc7832;&quot;&gt;from &lt;/span&gt;datetime &lt;span style=&quot;color:#cc7832;&quot;&gt;import &lt;/span&gt;timedelta&lt;br&gt;&lt;span style=&quot;color:#cc7832;&quot;&gt;from &lt;/span&gt;enum &lt;span style=&quot;color:#cc7832;&quot;&gt;import &lt;/span&gt;Enum&lt;br&gt;&lt;br&gt;&lt;span style=&quot;color:#cc7832;&quot;&gt;import &lt;/span&gt;openpyxl.utils&lt;br&gt;&lt;span style=&quot;color:#cc7832;&quot;&gt;from &lt;/span&gt;openpyxl &lt;span style=&quot;color:#cc7832;&quot;&gt;import &lt;/span&gt;load_workbook&lt;br&gt;&lt;span style=&quot;color:#cc7832;&quot;&gt;from &lt;/span&gt;openpyxl.styles &lt;span style=&quot;color:#cc7832;&quot;&gt;import &lt;/span&gt;*&lt;br&gt;&lt;br&gt;dt = &lt;span style=&quot;color:#6a8759;&quot;&gt;&#39;%Y/%m/%d %H:%M:%S&#39;&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;color:#6a8759;&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;color:#6a8759;&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;color:#808080;&quot;&gt;# shift (datetime, ShiftType)&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;color:#cc7832;&quot;&gt;class &lt;/span&gt;ShiftType(Enum):&lt;br&gt;    A = (&lt;span style=&quot;color:#6897bb;&quot;&gt;8&lt;/span&gt;&lt;span style=&quot;color:#cc7832;&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;color:#6897bb;&quot;&gt;20&lt;/span&gt;&lt;span style=&quot;color:#cc7832;&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;color:#6897bb;&quot;&gt;0&lt;/span&gt;)&lt;br&gt;    B = (&lt;span style=&quot;color:#6897bb;&quot;&gt;20&lt;/span&gt;&lt;span style=&quot;color:#cc7832;&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;color:#6897bb;&quot;&gt;32&lt;/span&gt;&lt;span style=&quot;color:#cc7832;&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;color:#6897bb;&quot;&gt;1&lt;/span&gt;)&lt;br&gt;    C = (&lt;span style=&quot;color:#6897bb;&quot;&gt;8&lt;/span&gt;&lt;span style=&quot;color:#cc7832;&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;color:#6897bb;&quot;&gt;18&lt;/span&gt;&lt;span style=&quot;color:#cc7832;&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;color:#6897bb;&quot;&gt;2&lt;/span&gt;)&lt;br&gt;    D = (&lt;span style=&quot;color:#6897bb;&quot;&gt;9&lt;/span&gt;&lt;span style=&quot;color:#cc7832;&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;color:#6897bb;&quot;&gt;18&lt;/span&gt;&lt;span style=&quot;color:#cc7832;&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;color:#6897bb;&quot;&gt;2&lt;/span&gt;)&lt;br&gt;&lt;br&gt;    &lt;span style=&quot;color:#bbb529;&quot;&gt;@classmethod&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;color:#bbb529;&quot;&gt;    &lt;/span&gt;&lt;span style=&quot;color:#cc7832;&quot;&gt;def &lt;/span&gt;&lt;span style=&quot;color:#ffc66d;&quot;&gt;value_of&lt;/span&gt;(&lt;span style=&quot;color:#94558d;&quot;&gt;cls&lt;/span&gt;&lt;span style=&quot;color:#cc7832;&quot;&gt;, &lt;/span&gt;value):&lt;br&gt;        &lt;span style=&quot;color:#cc7832;&quot;&gt;for &lt;/span&gt;k&lt;span style=&quot;color:#cc7832;&quot;&gt;, &lt;/span&gt;v &lt;span style=&quot;color:#cc7832;&quot;&gt;in &lt;/span&gt;&lt;span style=&quot;color:#94558d;&quot;&gt;cls&lt;/span&gt;.&lt;span style=&quot;color:#b200b2;&quot;&gt;__members__&lt;/span&gt;.items():&lt;br&gt;            &lt;span style=&quot;color:#cc7832;&quot;&gt;if &lt;/span&gt;k == value:&lt;br&gt;                &lt;span style=&quot;color:#cc7832;&quot;&gt;return &lt;/span&gt;v&lt;br&gt;        &lt;span style=&quot;color:#cc7832;&quot;&gt;else&lt;/span&gt;:&lt;br&gt;            &lt;span style=&quot;color:#cc7832;&quot;&gt;raise &lt;/span&gt;&lt;span style=&quot;color:#8888c6;&quot;&gt;ValueError&lt;/span&gt;(&lt;span style=&quot;color:#6a8759;&quot;&gt;f&quot;&#39;&lt;/span&gt;&lt;span style=&quot;color:#cc7832;&quot;&gt;{&lt;/span&gt;&lt;span style=&quot;color:#94558d;&quot;&gt;cls&lt;/span&gt;.&lt;span style=&quot;color:#b200b2;&quot;&gt;__name__&lt;/span&gt;&lt;span style=&quot;color:#cc7832;&quot;&gt;}&lt;/span&gt;&lt;span style=&quot;color:#6a8759;&quot;&gt;&#39; enum not found for &#39;&lt;/span&gt;&lt;span style=&quot;color:#cc7832;&quot;&gt;{&lt;/span&gt;value&lt;span style=&quot;color:#cc7832;&quot;&gt;}&lt;/span&gt;&lt;span style=&quot;color:#6a8759;&quot;&gt;&#39;&quot;&lt;/span&gt;)&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;span style=&quot;color:#cc7832;&quot;&gt;def &lt;/span&gt;&lt;span style=&quot;color:#ffc66d;&quot;&gt;resource_path&lt;/span&gt;(relative_path):&lt;br&gt;    &lt;span style=&quot;color:#cc7832;&quot;&gt;if &lt;/span&gt;&lt;span style=&quot;color:#8888c6;&quot;&gt;getattr&lt;/span&gt;(sys&lt;span style=&quot;color:#cc7832;&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;color:#6a8759;&quot;&gt;&#39;frozen&#39;&lt;/span&gt;&lt;span style=&quot;color:#cc7832;&quot;&gt;, False&lt;/span&gt;):&lt;br&gt;        base_path = sys._MEIPASS&lt;br&gt;    &lt;span style=&quot;color:#cc7832;&quot;&gt;else&lt;/span&gt;:&lt;br&gt;        base_path = os.path.abspath(&lt;span style=&quot;color:#6a8759;&quot;&gt;&quot;.&quot;&lt;/span&gt;)&lt;br&gt;    &lt;span style=&quot;color:#cc7832;&quot;&gt;return &lt;/span&gt;os.path.join(base_path&lt;span style=&quot;color:#cc7832;&quot;&gt;, &lt;/span&gt;relative_path)&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;span style=&quot;color:#cc7832;&quot;&gt;def &lt;/span&gt;&lt;span style=&quot;color:#ffc66d;&quot;&gt;cal_working_hours&lt;/span&gt;(shift_roaster_data&lt;span style=&quot;color:#cc7832;&quot;&gt;, &lt;/span&gt;badge_scan_data):&lt;br&gt;    &lt;span style=&quot;color:#cc7832;&quot;&gt;for &lt;/span&gt;schedule &lt;span style=&quot;color:#cc7832;&quot;&gt;in &lt;/span&gt;shift_roaster_data:&lt;br&gt;        login = schedule[&lt;span style=&quot;color:#6a8759;&quot;&gt;&#39;login&#39;&lt;/span&gt;]&lt;br&gt;        shift_list = schedule[&lt;span style=&quot;color:#6a8759;&quot;&gt;&#39;shift_list&#39;&lt;/span&gt;]&lt;br&gt;        &lt;span style=&quot;color:#cc7832;&quot;&gt;for &lt;/span&gt;shift &lt;span style=&quot;color:#cc7832;&quot;&gt;in &lt;/span&gt;shift_list:&lt;br&gt;            shift_date = shift[&lt;span style=&quot;color:#6a8759;&quot;&gt;&#39;datetime&#39;&lt;/span&gt;]&lt;br&gt;            shift_type = shift[&lt;span style=&quot;color:#6a8759;&quot;&gt;&#39;shift_type&#39;&lt;/span&gt;]&lt;br&gt;&lt;br&gt;            &lt;span style=&quot;color:#808080;&quot;&gt;# timestamp&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;color:#808080;&quot;&gt;            &lt;/span&gt;&lt;span style=&quot;color:#cc7832;&quot;&gt;def &lt;/span&gt;&lt;span style=&quot;color:#ffc66d;&quot;&gt;shift_datetime_helper&lt;/span&gt;(t):&lt;br&gt;                &lt;span style=&quot;color:#cc7832;&quot;&gt;if &lt;/span&gt;t &amp;gt; &lt;span style=&quot;color:#6897bb;&quot;&gt;24&lt;/span&gt;:&lt;br&gt;                    &lt;span style=&quot;color:#cc7832;&quot;&gt;return &lt;/span&gt;shift_date + timedelta(&lt;span style=&quot;color:#aa4926;&quot;&gt;hours&lt;/span&gt;=t - &lt;span style=&quot;color:#6897bb;&quot;&gt;24&lt;/span&gt;) + timedelta(&lt;span style=&quot;color:#aa4926;&quot;&gt;days&lt;/span&gt;=&lt;span style=&quot;color:#6897bb;&quot;&gt;1&lt;/span&gt;)&lt;br&gt;                &lt;span style=&quot;color:#cc7832;&quot;&gt;return &lt;/span&gt;shift_date + timedelta(&lt;span style=&quot;color:#aa4926;&quot;&gt;hours&lt;/span&gt;=t)&lt;br&gt;&lt;br&gt;            shift_start_time = shift_datetime_helper(shift_type.value[&lt;span style=&quot;color:#6897bb;&quot;&gt;0&lt;/span&gt;])&lt;br&gt;            shift_end_time = shift_datetime_helper(shift_type.value[&lt;span style=&quot;color:#6897bb;&quot;&gt;1&lt;/span&gt;])&lt;br&gt;            shift_hours = shift_type.value[&lt;span style=&quot;color:#6897bb;&quot;&gt;1&lt;/span&gt;] - shift_type.value[&lt;span style=&quot;color:#6897bb;&quot;&gt;0&lt;/span&gt;]&lt;br&gt;&lt;br&gt;            &lt;span style=&quot;color:#808080;&quot;&gt;# 1 hour&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;color:#808080;&quot;&gt;            &lt;/span&gt;screening_period = timedelta(&lt;span style=&quot;color:#aa4926;&quot;&gt;hours&lt;/span&gt;=&lt;span style=&quot;color:#6897bb;&quot;&gt;1&lt;/span&gt;)&lt;br&gt;            badge_scan_time1 = &lt;span style=&quot;color:#cc7832;&quot;&gt;None&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;color:#cc7832;&quot;&gt;            &lt;/span&gt;badge_scan_time2 = &lt;span style=&quot;color:#cc7832;&quot;&gt;None&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;color:#cc7832;&quot;&gt;            &lt;/span&gt;badge_scan_interval = &lt;span style=&quot;color:#6897bb;&quot;&gt;0&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;color:#6897bb;&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;color:#6897bb;&quot;&gt;            &lt;/span&gt;&lt;span style=&quot;color:#808080;&quot;&gt;# &lt;/span&gt;&lt;span style=&quot;color:#808080;font-family:&#39;宋体&#39;,monospace;&quot;&gt;扫描当前与前后两天的刷卡数据&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;color:#808080;font-family:&#39;宋体&#39;,monospace;&quot;&gt;            &lt;/span&gt;need_scan_datetime = [shift_date - timedelta(&lt;span style=&quot;color:#aa4926;&quot;&gt;days&lt;/span&gt;=&lt;span style=&quot;color:#6897bb;&quot;&gt;1&lt;/span&gt;)&lt;span style=&quot;color:#cc7832;&quot;&gt;, &lt;/span&gt;shift_date&lt;span style=&quot;color:#cc7832;&quot;&gt;, &lt;/span&gt;shift_date + timedelta(&lt;span style=&quot;color:#aa4926;&quot;&gt;days&lt;/span&gt;=&lt;span style=&quot;color:#6897bb;&quot;&gt;1&lt;/span&gt;)]&lt;br&gt;            need_scan_data = []&lt;br&gt;            &lt;span style=&quot;color:#cc7832;&quot;&gt;for &lt;/span&gt;scan_datetime &lt;span style=&quot;color:#cc7832;&quot;&gt;in &lt;/span&gt;need_scan_datetime:&lt;br&gt;                scan_key = &lt;span style=&quot;color:#6a8759;&quot;&gt;&quot;%s-%d%d%d&quot; &lt;/span&gt;% (login&lt;span style=&quot;color:#cc7832;&quot;&gt;, &lt;/span&gt;scan_datetime.year&lt;span style=&quot;color:#cc7832;&quot;&gt;, &lt;/span&gt;scan_datetime.month&lt;span style=&quot;color:#cc7832;&quot;&gt;, &lt;/span&gt;scan_datetime.day)&lt;br&gt;                &lt;span style=&quot;color:#cc7832;&quot;&gt;if &lt;/span&gt;scan_key &lt;span style=&quot;color:#cc7832;&quot;&gt;in &lt;/span&gt;badge_scan_data:&lt;br&gt;                    need_scan_data = need_scan_data + badge_scan_data[scan_key]&lt;br&gt;&lt;br&gt;            scan_left_idx = bisect.bisect_left(need_scan_data&lt;span style=&quot;color:#cc7832;&quot;&gt;, &lt;/span&gt;shift_start_time - screening_period)&lt;br&gt;            &lt;span style=&quot;color:#cc7832;&quot;&gt;if &lt;/span&gt;&lt;span style=&quot;color:#8888c6;&quot;&gt;len&lt;/span&gt;(need_scan_data) &amp;gt; scan_left_idx &amp;gt; &lt;span style=&quot;color:#6897bb;&quot;&gt;0 &lt;/span&gt;&lt;span style=&quot;color:#cc7832;&quot;&gt;and &lt;/span&gt;shift_start_time &amp;gt;= need_scan_data[scan_left_idx]:&lt;br&gt;                badge_scan_time1 = &lt;span style=&quot;color:#8888c6;&quot;&gt;max&lt;/span&gt;(need_scan_data[scan_left_idx]&lt;span style=&quot;color:#cc7832;&quot;&gt;, &lt;/span&gt;shift_start_time)&lt;br&gt;&lt;br&gt;            scan_right_idx = bisect.bisect_right(need_scan_data&lt;span style=&quot;color:#cc7832;&quot;&gt;, &lt;/span&gt;shift_end_time + screening_period) - &lt;span style=&quot;color:#6897bb;&quot;&gt;1&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;color:#6897bb;&quot;&gt;            &lt;/span&gt;&lt;span style=&quot;color:#cc7832;&quot;&gt;if &lt;/span&gt;&lt;span style=&quot;color:#8888c6;&quot;&gt;len&lt;/span&gt;(need_scan_data) &amp;gt; scan_right_idx &amp;gt; &lt;span style=&quot;color:#6897bb;&quot;&gt;0 &lt;/span&gt;&lt;span style=&quot;color:#cc7832;&quot;&gt;and &lt;/span&gt;((&lt;br&gt;                    badge_scan_time1 &lt;span style=&quot;color:#cc7832;&quot;&gt;if &lt;/span&gt;badge_scan_time1 &lt;span style=&quot;color:#cc7832;&quot;&gt;else &lt;/span&gt;shift_end_time&lt;br&gt;            )) &amp;lt;= need_scan_data[scan_right_idx]:&lt;br&gt;                badge_scan_time2 = &lt;span style=&quot;color:#8888c6;&quot;&gt;min&lt;/span&gt;(need_scan_data[scan_right_idx]&lt;span style=&quot;color:#cc7832;&quot;&gt;, &lt;/span&gt;shift_end_time)&lt;br&gt;&lt;br&gt;            &lt;span style=&quot;color:#cc7832;&quot;&gt;if &lt;/span&gt;badge_scan_time1 &lt;span style=&quot;color:#cc7832;&quot;&gt;and &lt;/span&gt;badge_scan_time2:&lt;br&gt;                badge_scan_interval = \&lt;br&gt;                    (&lt;span style=&quot;color:#8888c6;&quot;&gt;int&lt;/span&gt;(badge_scan_time2.timestamp()) - &lt;span style=&quot;color:#8888c6;&quot;&gt;int&lt;/span&gt;(badge_scan_time1.timestamp())) / (&lt;span style=&quot;color:#6897bb;&quot;&gt;60 &lt;/span&gt;* &lt;span style=&quot;color:#6897bb;&quot;&gt;60&lt;/span&gt;)&lt;br&gt;                &lt;span style=&quot;color:#cc7832;&quot;&gt;if &lt;/span&gt;shift_hours - badge_scan_interval &amp;lt;= &lt;span style=&quot;color:#6897bb;&quot;&gt;0.25&lt;/span&gt;:&lt;br&gt;                    badge_scan_interval = shift_hours&lt;br&gt;                badge_scan_interval = &lt;span style=&quot;color:#8888c6;&quot;&gt;min&lt;/span&gt;(shift_hours&lt;span style=&quot;color:#cc7832;&quot;&gt;, &lt;/span&gt;badge_scan_interval)&lt;br&gt;            shift[&lt;span style=&quot;color:#6a8759;&quot;&gt;&#39;shift_hours&#39;&lt;/span&gt;] = shift_hours&lt;br&gt;            shift[&lt;span style=&quot;color:#6a8759;&quot;&gt;&#39;working_hours&#39;&lt;/span&gt;] = (badge_scan_time1&lt;span style=&quot;color:#cc7832;&quot;&gt;, &lt;/span&gt;badge_scan_time2&lt;span style=&quot;color:#cc7832;&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;color:#8888c6;&quot;&gt;round&lt;/span&gt;(badge_scan_interval&lt;span style=&quot;color:#cc7832;&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;color:#6897bb;&quot;&gt;2&lt;/span&gt;))&lt;br&gt;            &lt;span style=&quot;color:#8888c6;&quot;&gt;print&lt;/span&gt;(shift[&lt;span style=&quot;color:#6a8759;&quot;&gt;&#39;working_hours&#39;&lt;/span&gt;])&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;span style=&quot;color:#cc7832;&quot;&gt;def &lt;/span&gt;&lt;span style=&quot;color:#ffc66d;&quot;&gt;load_sheet_data&lt;/span&gt;(sheet&lt;span style=&quot;color:#cc7832;&quot;&gt;, &lt;/span&gt;fields&lt;span style=&quot;color:#cc7832;&quot;&gt;, &lt;/span&gt;min_row&lt;span style=&quot;color:#cc7832;&quot;&gt;, &lt;/span&gt;break_cond):&lt;br&gt;    ret = []&lt;br&gt;    &lt;span style=&quot;color:#cc7832;&quot;&gt;for &lt;/span&gt;row &lt;span style=&quot;color:#cc7832;&quot;&gt;in &lt;/span&gt;sheet.iter_rows(&lt;span style=&quot;color:#aa4926;&quot;&gt;min_row&lt;/span&gt;=min_row&lt;span style=&quot;color:#cc7832;&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;color:#aa4926;&quot;&gt;max_row&lt;/span&gt;=&lt;span style=&quot;color:#6897bb;&quot;&gt;100&lt;/span&gt;&lt;span style=&quot;color:#cc7832;&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;color:#aa4926;&quot;&gt;min_col&lt;/span&gt;=&lt;span style=&quot;color:#6897bb;&quot;&gt;1&lt;/span&gt;&lt;span style=&quot;color:#cc7832;&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;color:#aa4926;&quot;&gt;max_col&lt;/span&gt;=&lt;span style=&quot;color:#6897bb;&quot;&gt;100&lt;/span&gt;&lt;span style=&quot;color:#cc7832;&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;color:#aa4926;&quot;&gt;values_only&lt;/span&gt;=&lt;span style=&quot;color:#cc7832;&quot;&gt;True&lt;/span&gt;):&lt;br&gt;        obj = {}&lt;br&gt;        j = &lt;span style=&quot;color:#6897bb;&quot;&gt;1&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;color:#6897bb;&quot;&gt;        &lt;/span&gt;&lt;span style=&quot;color:#cc7832;&quot;&gt;for &lt;/span&gt;val &lt;span style=&quot;color:#cc7832;&quot;&gt;in &lt;/span&gt;row:&lt;br&gt;            obj[fields[j - &lt;span style=&quot;color:#6897bb;&quot;&gt;1&lt;/span&gt;]] = val&lt;br&gt;            j = j + &lt;span style=&quot;color:#6897bb;&quot;&gt;1&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;color:#6897bb;&quot;&gt;            &lt;/span&gt;&lt;span style=&quot;color:#cc7832;&quot;&gt;if &lt;/span&gt;j &amp;gt; &lt;span style=&quot;color:#8888c6;&quot;&gt;len&lt;/span&gt;(fields):&lt;br&gt;                &lt;span style=&quot;color:#cc7832;&quot;&gt;break&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;color:#cc7832;&quot;&gt;        if &lt;/span&gt;break_cond(obj):&lt;br&gt;            &lt;span style=&quot;color:#cc7832;&quot;&gt;break&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;color:#cc7832;&quot;&gt;        if &lt;/span&gt;&lt;span style=&quot;color:#8888c6;&quot;&gt;any&lt;/span&gt;(obj):&lt;br&gt;            ret.append(obj)&lt;br&gt;    &lt;span style=&quot;color:#cc7832;&quot;&gt;return &lt;/span&gt;ret&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;span style=&quot;color:#cc7832;&quot;&gt;def &lt;/span&gt;&lt;span style=&quot;color:#ffc66d;&quot;&gt;get_shift_roaster_fields&lt;/span&gt;(sheet):&lt;br&gt;    daily_list = []&lt;br&gt;    &lt;span style=&quot;color:#cc7832;&quot;&gt;for &lt;/span&gt;row &lt;span style=&quot;color:#cc7832;&quot;&gt;in &lt;/span&gt;sheet.iter_cols(&lt;span style=&quot;color:#aa4926;&quot;&gt;min_row&lt;/span&gt;=&lt;span style=&quot;color:#6897bb;&quot;&gt;4&lt;/span&gt;&lt;span style=&quot;color:#cc7832;&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;color:#aa4926;&quot;&gt;max_row&lt;/span&gt;=&lt;span style=&quot;color:#6897bb;&quot;&gt;4&lt;/span&gt;&lt;span style=&quot;color:#cc7832;&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;color:#aa4926;&quot;&gt;min_col&lt;/span&gt;=&lt;span style=&quot;color:#6897bb;&quot;&gt;1&lt;/span&gt;&lt;span style=&quot;color:#cc7832;&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;color:#aa4926;&quot;&gt;max_col&lt;/span&gt;=&lt;span style=&quot;color:#6897bb;&quot;&gt;100&lt;/span&gt;&lt;span style=&quot;color:#cc7832;&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;color:#aa4926;&quot;&gt;values_only&lt;/span&gt;=&lt;span style=&quot;color:#cc7832;&quot;&gt;True&lt;/span&gt;):&lt;br&gt;        &lt;span style=&quot;color:#cc7832;&quot;&gt;for &lt;/span&gt;val &lt;span style=&quot;color:#cc7832;&quot;&gt;in &lt;/span&gt;row:&lt;br&gt;            &lt;span style=&quot;color:#cc7832;&quot;&gt;if &lt;/span&gt;val:&lt;br&gt;                &lt;span style=&quot;color:#cc7832;&quot;&gt;if &lt;/span&gt;&lt;span style=&quot;color:#8888c6;&quot;&gt;isinstance&lt;/span&gt;(val&lt;span style=&quot;color:#cc7832;&quot;&gt;, &lt;/span&gt;datetime):&lt;br&gt;                    daily_list.append(val.day)&lt;br&gt;                &lt;span style=&quot;color:#cc7832;&quot;&gt;elif &lt;/span&gt;&lt;span style=&quot;color:#8888c6;&quot;&gt;str&lt;/span&gt;(val).isnumeric():&lt;br&gt;                    daily_list.append(val)&lt;br&gt;    &lt;span style=&quot;color:#cc7832;&quot;&gt;return &lt;/span&gt;[&lt;span style=&quot;color:#6a8759;&quot;&gt;&#39;eid&#39;&lt;/span&gt;&lt;span style=&quot;color:#cc7832;&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;color:#6a8759;&quot;&gt;&#39;login&#39;&lt;/span&gt;&lt;span style=&quot;color:#cc7832;&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;color:#6a8759;&quot;&gt;&#39;name&#39;&lt;/span&gt;&lt;span style=&quot;color:#cc7832;&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;color:#6a8759;&quot;&gt;&#39;title&#39;&lt;/span&gt;&lt;span style=&quot;color:#cc7832;&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;color:#6a8759;&quot;&gt;&#39;role&#39;&lt;/span&gt;]&lt;span style=&quot;color:#cc7832;&quot;&gt;, &lt;/span&gt;daily_list&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;span style=&quot;color:#cc7832;&quot;&gt;def &lt;/span&gt;&lt;span style=&quot;color:#ffc66d;&quot;&gt;load_shift_roaster_data&lt;/span&gt;(fn&lt;span style=&quot;color:#cc7832;&quot;&gt;, &lt;/span&gt;sheet):&lt;br&gt;    ret = []&lt;br&gt;    wb = load_workbook(fn&lt;span style=&quot;color:#cc7832;&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;color:#aa4926;&quot;&gt;data_only&lt;/span&gt;=&lt;span style=&quot;color:#cc7832;&quot;&gt;True&lt;/span&gt;)&lt;br&gt;&lt;br&gt;    date_value = wb[sheet][&lt;span style=&quot;color:#6a8759;&quot;&gt;&#39;B3&#39;&lt;/span&gt;].value&lt;br&gt;    year&lt;span style=&quot;color:#cc7832;&quot;&gt;, &lt;/span&gt;month = date_value.year&lt;span style=&quot;color:#cc7832;&quot;&gt;, &lt;/span&gt;date_value.month&lt;br&gt;    fields_base&lt;span style=&quot;color:#cc7832;&quot;&gt;, &lt;/span&gt;fields_daily = get_shift_roaster_fields(wb[sheet])&lt;br&gt;&lt;br&gt;    tb = load_sheet_data(wb[sheet]&lt;span style=&quot;color:#cc7832;&quot;&gt;, &lt;/span&gt;fields_base + fields_daily&lt;span style=&quot;color:#cc7832;&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;color:#6897bb;&quot;&gt;6&lt;/span&gt;&lt;span style=&quot;color:#cc7832;&quot;&gt;, lambda &lt;/span&gt;v: &lt;span style=&quot;color:#cc7832;&quot;&gt;not &lt;/span&gt;v[&lt;span style=&quot;color:#6a8759;&quot;&gt;&#39;login&#39;&lt;/span&gt;])&lt;br&gt;    &lt;span style=&quot;color:#cc7832;&quot;&gt;for &lt;/span&gt;item &lt;span style=&quot;color:#cc7832;&quot;&gt;in &lt;/span&gt;tb:&lt;br&gt;        shift_list = []&lt;br&gt;        &lt;span style=&quot;color:#cc7832;&quot;&gt;for &lt;/span&gt;d &lt;span style=&quot;color:#cc7832;&quot;&gt;in &lt;/span&gt;fields_daily:&lt;br&gt;            &lt;span style=&quot;color:#cc7832;&quot;&gt;if &lt;/span&gt;item[d]:&lt;br&gt;                shift_list.append({&lt;br&gt;                    &lt;span style=&quot;color:#6a8759;&quot;&gt;&#39;datetime&#39;&lt;/span&gt;: datetime.strptime(&lt;span style=&quot;color:#6a8759;&quot;&gt;&#39;{:04d}/{:d}/{:d} 00:00:00&#39;&lt;/span&gt;.format(year&lt;span style=&quot;color:#cc7832;&quot;&gt;, &lt;/span&gt;month&lt;span style=&quot;color:#cc7832;&quot;&gt;, &lt;/span&gt;d)&lt;span style=&quot;color:#cc7832;&quot;&gt;, &lt;/span&gt;dt)&lt;span style=&quot;color:#cc7832;&quot;&gt;,&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;color:#cc7832;&quot;&gt;                    &lt;/span&gt;&lt;span style=&quot;color:#6a8759;&quot;&gt;&#39;shift_type&#39;&lt;/span&gt;: ShiftType.value_of(item[d])&lt;br&gt;                })&lt;br&gt;            &lt;span style=&quot;color:#cc7832;&quot;&gt;del &lt;/span&gt;item[d]&lt;br&gt;        item[&lt;span style=&quot;color:#6a8759;&quot;&gt;&#39;shift_list&#39;&lt;/span&gt;] = shift_list&lt;br&gt;        ret.append(item)&lt;br&gt;    wb.close()&lt;br&gt;    &lt;span style=&quot;color:#cc7832;&quot;&gt;return &lt;/span&gt;ret&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;span style=&quot;color:#cc7832;&quot;&gt;def &lt;/span&gt;&lt;span style=&quot;color:#ffc66d;&quot;&gt;load_badge_scan_data&lt;/span&gt;(fn):&lt;br&gt;    ret = {}&lt;br&gt;&lt;br&gt;    fields = [&lt;span style=&quot;color:#6a8759;&quot;&gt;&#39;id&#39;&lt;/span&gt;&lt;span style=&quot;color:#cc7832;&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;color:#6a8759;&quot;&gt;&#39;login&#39;&lt;/span&gt;&lt;span style=&quot;color:#cc7832;&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;color:#6a8759;&quot;&gt;&#39;_&#39;&lt;/span&gt;&lt;span style=&quot;color:#cc7832;&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;color:#6a8759;&quot;&gt;&#39;_&#39;&lt;/span&gt;&lt;span style=&quot;color:#cc7832;&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;color:#6a8759;&quot;&gt;&#39;_&#39;&lt;/span&gt;&lt;span style=&quot;color:#cc7832;&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;color:#6a8759;&quot;&gt;&#39;_&#39;&lt;/span&gt;&lt;span style=&quot;color:#cc7832;&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;color:#6a8759;&quot;&gt;&#39;_&#39;&lt;/span&gt;&lt;span style=&quot;color:#cc7832;&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;color:#6a8759;&quot;&gt;&#39;_&#39;&lt;/span&gt;&lt;span style=&quot;color:#cc7832;&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;color:#6a8759;&quot;&gt;&#39;_&#39;&lt;/span&gt;&lt;span style=&quot;color:#cc7832;&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;color:#6a8759;&quot;&gt;&#39;local_time&#39;&lt;/span&gt;]&lt;br&gt;    wb = load_workbook(fn&lt;span style=&quot;color:#cc7832;&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;color:#aa4926;&quot;&gt;data_only&lt;/span&gt;=&lt;span style=&quot;color:#cc7832;&quot;&gt;True&lt;/span&gt;)&lt;br&gt;    tb = load_sheet_data(wb.active&lt;span style=&quot;color:#cc7832;&quot;&gt;, &lt;/span&gt;fields&lt;span style=&quot;color:#cc7832;&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;color:#6897bb;&quot;&gt;2&lt;/span&gt;&lt;span style=&quot;color:#cc7832;&quot;&gt;, lambda &lt;/span&gt;v: &lt;span style=&quot;color:#cc7832;&quot;&gt;not &lt;/span&gt;v[&lt;span style=&quot;color:#6a8759;&quot;&gt;&#39;login&#39;&lt;/span&gt;])&lt;br&gt;    tb.sort(&lt;span style=&quot;color:#aa4926;&quot;&gt;key&lt;/span&gt;=&lt;span style=&quot;color:#cc7832;&quot;&gt;lambda &lt;/span&gt;x: x[&lt;span style=&quot;color:#6a8759;&quot;&gt;&#39;local_time&#39;&lt;/span&gt;])&lt;br&gt;&lt;br&gt;    &lt;span style=&quot;color:#cc7832;&quot;&gt;for &lt;/span&gt;item &lt;span style=&quot;color:#cc7832;&quot;&gt;in &lt;/span&gt;tb:&lt;br&gt;        login = item[&lt;span style=&quot;color:#6a8759;&quot;&gt;&#39;login&#39;&lt;/span&gt;]&lt;br&gt;        local_time = item[&lt;span style=&quot;color:#6a8759;&quot;&gt;&#39;local_time&#39;&lt;/span&gt;]&lt;br&gt;        login_key = &lt;span style=&quot;color:#6a8759;&quot;&gt;&quot;%s-%d%d%d&quot; &lt;/span&gt;% (login&lt;span style=&quot;color:#cc7832;&quot;&gt;, &lt;/span&gt;local_time.year&lt;span style=&quot;color:#cc7832;&quot;&gt;, &lt;/span&gt;local_time.month&lt;span style=&quot;color:#cc7832;&quot;&gt;, &lt;/span&gt;local_time.day)&lt;br&gt;        &lt;span style=&quot;color:#cc7832;&quot;&gt;if &lt;/span&gt;login_key &lt;span style=&quot;color:#cc7832;&quot;&gt;not in &lt;/span&gt;ret:&lt;br&gt;            ret[login_key] = []&lt;br&gt;        ret[login_key].append(local_time)&lt;br&gt;&lt;br&gt;    wb.close()&lt;br&gt;    &lt;span style=&quot;color:#cc7832;&quot;&gt;return &lt;/span&gt;ret&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;span style=&quot;color:#cc7832;&quot;&gt;def &lt;/span&gt;&lt;span style=&quot;color:#ffc66d;&quot;&gt;generate_validated_sheet&lt;/span&gt;(&lt;span style=&quot;color:#72737a;&quot;&gt;src_wb&lt;/span&gt;&lt;span style=&quot;color:#cc7832;&quot;&gt;, &lt;/span&gt;src_sheet&lt;span style=&quot;color:#cc7832;&quot;&gt;, &lt;/span&gt;dst_sheet&lt;span style=&quot;color:#cc7832;&quot;&gt;, &lt;/span&gt;shift_roaster_data):&lt;br&gt;    &lt;span style=&quot;color:#cc7832;&quot;&gt;def &lt;/span&gt;&lt;span style=&quot;color:#ffc66d;&quot;&gt;copy_row_style&lt;/span&gt;(src_row_idx&lt;span style=&quot;color:#cc7832;&quot;&gt;, &lt;/span&gt;dst_row_idx&lt;span style=&quot;color:#cc7832;&quot;&gt;, &lt;/span&gt;exclude_fill=&lt;span style=&quot;color:#cc7832;&quot;&gt;False&lt;/span&gt;):&lt;br&gt;        rs = dst_sheet.row_dimensions[src_row_idx].height&lt;br&gt;        &lt;span style=&quot;color:#cc7832;&quot;&gt;if &lt;/span&gt;rs &lt;span style=&quot;color:#cc7832;&quot;&gt;is not None&lt;/span&gt;:&lt;br&gt;            dst_sheet.row_dimensions[dst_row_idx].height = rs&lt;br&gt;        max_col = dst_sheet.max_column&lt;br&gt;        &lt;span style=&quot;color:#cc7832;&quot;&gt;for &lt;/span&gt;col &lt;span style=&quot;color:#cc7832;&quot;&gt;in &lt;/span&gt;&lt;span style=&quot;color:#8888c6;&quot;&gt;range&lt;/span&gt;(&lt;span style=&quot;color:#6897bb;&quot;&gt;1&lt;/span&gt;&lt;span style=&quot;color:#cc7832;&quot;&gt;, &lt;/span&gt;max_col + &lt;span style=&quot;color:#6897bb;&quot;&gt;1&lt;/span&gt;):&lt;br&gt;            col_n = openpyxl.utils.get_column_letter(col)&lt;br&gt;            copy_cell_style(dst_sheet[&lt;span style=&quot;color:#6a8759;&quot;&gt;&#39;%s%d&#39; &lt;/span&gt;% (col_n&lt;span style=&quot;color:#cc7832;&quot;&gt;, &lt;/span&gt;src_row_idx)]&lt;span style=&quot;color:#cc7832;&quot;&gt;, &lt;/span&gt;dst_sheet[&lt;span style=&quot;color:#6a8759;&quot;&gt;&#39;%s%d&#39; &lt;/span&gt;% (col_n&lt;span style=&quot;color:#cc7832;&quot;&gt;, &lt;/span&gt;dst_row_idx)]&lt;span style=&quot;color:#cc7832;&quot;&gt;,&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;color:#cc7832;&quot;&gt;                            &lt;/span&gt;exclude_fill)&lt;br&gt;&lt;br&gt;    &lt;span style=&quot;color:#cc7832;&quot;&gt;def &lt;/span&gt;&lt;span style=&quot;color:#ffc66d;&quot;&gt;copy_cell_style&lt;/span&gt;(src_cell&lt;span style=&quot;color:#cc7832;&quot;&gt;, &lt;/span&gt;dst_cell&lt;span style=&quot;color:#cc7832;&quot;&gt;, &lt;/span&gt;exclude_fill=&lt;span style=&quot;color:#cc7832;&quot;&gt;False&lt;/span&gt;):&lt;br&gt;        dst_cell.font = copy(src_cell.font)&lt;br&gt;        dst_cell.border = copy(src_cell.border)&lt;br&gt;        &lt;span style=&quot;color:#cc7832;&quot;&gt;if not &lt;/span&gt;exclude_fill:&lt;br&gt;            dst_cell.fill = copy(src_cell.fill)&lt;br&gt;        dst_cell.number_format = copy(src_cell.number_format)&lt;br&gt;        dst_cell.protection = copy(src_cell.protection)&lt;br&gt;        dst_cell.alignment = copy(src_cell.alignment)&lt;br&gt;&lt;br&gt;    &lt;span style=&quot;color:#cc7832;&quot;&gt;def &lt;/span&gt;&lt;span style=&quot;color:#ffc66d;&quot;&gt;copy_cell&lt;/span&gt;(src_cell&lt;span style=&quot;color:#cc7832;&quot;&gt;, &lt;/span&gt;dst_cell&lt;span style=&quot;color:#cc7832;&quot;&gt;, &lt;/span&gt;only_value=&lt;span style=&quot;color:#cc7832;&quot;&gt;False&lt;/span&gt;):&lt;br&gt;        dst_cell.value = copy(src_cell.value)&lt;br&gt;        &lt;span style=&quot;color:#cc7832;&quot;&gt;if &lt;/span&gt;only_value:&lt;br&gt;            &lt;span style=&quot;color:#cc7832;&quot;&gt;return&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;color:#cc7832;&quot;&gt;        &lt;/span&gt;copy_cell_style(src_cell&lt;span style=&quot;color:#cc7832;&quot;&gt;, &lt;/span&gt;dst_cell)&lt;br&gt;&lt;br&gt;    &lt;span style=&quot;color:#808080;&quot;&gt;# &lt;/span&gt;&lt;span style=&quot;color:#808080;font-family:&#39;宋体&#39;,monospace;&quot;&gt;复制表头&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;color:#808080;font-family:&#39;宋体&#39;,monospace;&quot;&gt;    &lt;/span&gt;&lt;span style=&quot;color:#808080;&quot;&gt;# &lt;/span&gt;&lt;span style=&quot;color:#808080;font-family:&#39;宋体&#39;,monospace;&quot;&gt;标题，时间&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;color:#808080;font-family:&#39;宋体&#39;,monospace;&quot;&gt;    &lt;/span&gt;copy_cell(src_sheet[&lt;span style=&quot;color:#6a8759;&quot;&gt;&#39;A1&#39;&lt;/span&gt;]&lt;span style=&quot;color:#cc7832;&quot;&gt;, &lt;/span&gt;dst_sheet[&lt;span style=&quot;color:#6a8759;&quot;&gt;&#39;A1&#39;&lt;/span&gt;])&lt;br&gt;    copy_cell(src_sheet[&lt;span style=&quot;color:#6a8759;&quot;&gt;&#39;B2&#39;&lt;/span&gt;]&lt;span style=&quot;color:#cc7832;&quot;&gt;, &lt;/span&gt;dst_sheet[&lt;span style=&quot;color:#6a8759;&quot;&gt;&#39;B2&#39;&lt;/span&gt;])&lt;br&gt;    copy_cell(src_sheet[&lt;span style=&quot;color:#6a8759;&quot;&gt;&#39;D2&#39;&lt;/span&gt;]&lt;span style=&quot;color:#cc7832;&quot;&gt;, &lt;/span&gt;dst_sheet[&lt;span style=&quot;color:#6a8759;&quot;&gt;&#39;D2&#39;&lt;/span&gt;])&lt;br&gt;    copy_cell(src_sheet[&lt;span style=&quot;color:#6a8759;&quot;&gt;&#39;B3&#39;&lt;/span&gt;]&lt;span style=&quot;color:#cc7832;&quot;&gt;, &lt;/span&gt;dst_sheet[&lt;span style=&quot;color:#6a8759;&quot;&gt;&#39;B3&#39;&lt;/span&gt;])&lt;br&gt;    copy_cell(src_sheet[&lt;span style=&quot;color:#6a8759;&quot;&gt;&#39;D3&#39;&lt;/span&gt;]&lt;span style=&quot;color:#cc7832;&quot;&gt;, &lt;/span&gt;dst_sheet[&lt;span style=&quot;color:#6a8759;&quot;&gt;&#39;D3&#39;&lt;/span&gt;])&lt;br&gt;&lt;br&gt;    employee_base_info&lt;span style=&quot;color:#cc7832;&quot;&gt;, &lt;/span&gt;daily_list = get_shift_roaster_fields(src_sheet)&lt;br&gt;&lt;br&gt;    blue_fill = copy(dst_sheet[&lt;span style=&quot;color:#6a8759;&quot;&gt;&#39;A5&#39;&lt;/span&gt;].fill)&lt;br&gt;    yellow_fill = copy(dst_sheet[&lt;span style=&quot;color:#6a8759;&quot;&gt;&#39;AL5&#39;&lt;/span&gt;].fill)&lt;br&gt;    &lt;span style=&quot;color:#808080;&quot;&gt;# &lt;/span&gt;&lt;span style=&quot;color:#808080;font-family:&#39;宋体&#39;,monospace;&quot;&gt;日历表&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;color:#808080;font-family:&#39;宋体&#39;,monospace;&quot;&gt;    &lt;/span&gt;date_value = src_sheet[&lt;span style=&quot;color:#6a8759;&quot;&gt;&#39;B3&#39;&lt;/span&gt;].value&lt;br&gt;    year&lt;span style=&quot;color:#cc7832;&quot;&gt;, &lt;/span&gt;month = date_value.year&lt;span style=&quot;color:#cc7832;&quot;&gt;, &lt;/span&gt;date_value.month&lt;br&gt;    day1&lt;span style=&quot;color:#cc7832;&quot;&gt;, &lt;/span&gt;days = calendar.monthrange(year&lt;span style=&quot;color:#cc7832;&quot;&gt;, &lt;/span&gt;month)&lt;br&gt;    day_name = [&lt;span style=&quot;color:#6a8759;&quot;&gt;&#39;&lt;/span&gt;&lt;span style=&quot;color:#6a8759;font-family:&#39;宋体&#39;,monospace;&quot;&gt;一&lt;/span&gt;&lt;span style=&quot;color:#6a8759;&quot;&gt;&#39;&lt;/span&gt;&lt;span style=&quot;color:#cc7832;&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;color:#6a8759;&quot;&gt;&#39;&lt;/span&gt;&lt;span style=&quot;color:#6a8759;font-family:&#39;宋体&#39;,monospace;&quot;&gt;二&lt;/span&gt;&lt;span style=&quot;color:#6a8759;&quot;&gt;&#39;&lt;/span&gt;&lt;span style=&quot;color:#cc7832;&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;color:#6a8759;&quot;&gt;&#39;&lt;/span&gt;&lt;span style=&quot;color:#6a8759;font-family:&#39;宋体&#39;,monospace;&quot;&gt;三&lt;/span&gt;&lt;span style=&quot;color:#6a8759;&quot;&gt;&#39;&lt;/span&gt;&lt;span style=&quot;color:#cc7832;&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;color:#6a8759;&quot;&gt;&#39;&lt;/span&gt;&lt;span style=&quot;color:#6a8759;font-family:&#39;宋体&#39;,monospace;&quot;&gt;四&lt;/span&gt;&lt;span style=&quot;color:#6a8759;&quot;&gt;&#39;&lt;/span&gt;&lt;span style=&quot;color:#cc7832;&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;color:#6a8759;&quot;&gt;&#39;&lt;/span&gt;&lt;span style=&quot;color:#6a8759;font-family:&#39;宋体&#39;,monospace;&quot;&gt;五&lt;/span&gt;&lt;span style=&quot;color:#6a8759;&quot;&gt;&#39;&lt;/span&gt;&lt;span style=&quot;color:#cc7832;&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;color:#6a8759;&quot;&gt;&#39;&lt;/span&gt;&lt;span style=&quot;color:#6a8759;font-family:&#39;宋体&#39;,monospace;&quot;&gt;六&lt;/span&gt;&lt;span style=&quot;color:#6a8759;&quot;&gt;&#39;&lt;/span&gt;&lt;span style=&quot;color:#cc7832;&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;color:#6a8759;&quot;&gt;&#39;&lt;/span&gt;&lt;span style=&quot;color:#6a8759;font-family:&#39;宋体&#39;,monospace;&quot;&gt;日&lt;/span&gt;&lt;span style=&quot;color:#6a8759;&quot;&gt;&#39;&lt;/span&gt;]&lt;br&gt;    &lt;span style=&quot;color:#cc7832;&quot;&gt;for &lt;/span&gt;d &lt;span style=&quot;color:#cc7832;&quot;&gt;in &lt;/span&gt;&lt;span style=&quot;color:#8888c6;&quot;&gt;range&lt;/span&gt;(&lt;span style=&quot;color:#6897bb;&quot;&gt;1&lt;/span&gt;&lt;span style=&quot;color:#cc7832;&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;color:#6897bb;&quot;&gt;32&lt;/span&gt;):&lt;br&gt;        col_idx = d + &lt;span style=&quot;color:#8888c6;&quot;&gt;len&lt;/span&gt;(employee_base_info)&lt;br&gt;        &lt;span style=&quot;color:#cc7832;&quot;&gt;if &lt;/span&gt;d &amp;lt;= days:&lt;br&gt;            day_cell = dst_sheet.cell(&lt;span style=&quot;color:#aa4926;&quot;&gt;row&lt;/span&gt;=&lt;span style=&quot;color:#6897bb;&quot;&gt;4&lt;/span&gt;&lt;span style=&quot;color:#cc7832;&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;color:#aa4926;&quot;&gt;column&lt;/span&gt;=col_idx)&lt;br&gt;            weekday_cell = dst_sheet.cell(&lt;span style=&quot;color:#aa4926;&quot;&gt;row&lt;/span&gt;=&lt;span style=&quot;color:#6897bb;&quot;&gt;5&lt;/span&gt;&lt;span style=&quot;color:#cc7832;&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;color:#aa4926;&quot;&gt;column&lt;/span&gt;=col_idx)&lt;br&gt;            day_cell.font = Font(&lt;span style=&quot;color:#aa4926;&quot;&gt;bold&lt;/span&gt;=&lt;span style=&quot;color:#cc7832;&quot;&gt;True&lt;/span&gt;)&lt;br&gt;            weekday_cell.font = Font(&lt;span style=&quot;color:#aa4926;&quot;&gt;bold&lt;/span&gt;=&lt;span style=&quot;color:#cc7832;&quot;&gt;True&lt;/span&gt;)&lt;br&gt;&lt;br&gt;            day_cell.value = d&lt;br&gt;            weekday_cell.value = day_name[(day1 + d - &lt;span style=&quot;color:#6897bb;&quot;&gt;1&lt;/span&gt;) % &lt;span style=&quot;color:#6897bb;&quot;&gt;7&lt;/span&gt;]&lt;br&gt;            &lt;span style=&quot;color:#cc7832;&quot;&gt;if &lt;/span&gt;weekday_cell.value == &lt;span style=&quot;color:#6a8759;&quot;&gt;&#39;&lt;/span&gt;&lt;span style=&quot;color:#6a8759;font-family:&#39;宋体&#39;,monospace;&quot;&gt;六&lt;/span&gt;&lt;span style=&quot;color:#6a8759;&quot;&gt;&#39; &lt;/span&gt;&lt;span style=&quot;color:#cc7832;&quot;&gt;or &lt;/span&gt;weekday_cell.value == &lt;span style=&quot;color:#6a8759;&quot;&gt;&#39;&lt;/span&gt;&lt;span style=&quot;color:#6a8759;font-family:&#39;宋体&#39;,monospace;&quot;&gt;日&lt;/span&gt;&lt;span style=&quot;color:#6a8759;&quot;&gt;&#39;&lt;/span&gt;:&lt;br&gt;                weekday_cell.font = Font(&lt;span style=&quot;color:#aa4926;&quot;&gt;color&lt;/span&gt;=&lt;span style=&quot;color:#6a8759;&quot;&gt;&#39;9c0006&#39;&lt;/span&gt;&lt;span style=&quot;color:#cc7832;&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;color:#aa4926;&quot;&gt;bold&lt;/span&gt;=&lt;span style=&quot;color:#cc7832;&quot;&gt;True&lt;/span&gt;)&lt;br&gt;    &lt;span style=&quot;color:#808080;&quot;&gt;# &lt;/span&gt;&lt;span style=&quot;color:#808080;font-family:&#39;宋体&#39;,monospace;&quot;&gt;排班表&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;color:#808080;font-family:&#39;宋体&#39;,monospace;&quot;&gt;    &lt;/span&gt;schedule_row_idx = &lt;span style=&quot;color:#6897bb;&quot;&gt;6&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;color:#6897bb;&quot;&gt;    &lt;/span&gt;&lt;span style=&quot;color:#cc7832;&quot;&gt;for &lt;/span&gt;schedule &lt;span style=&quot;color:#cc7832;&quot;&gt;in &lt;/span&gt;shift_roaster_data:&lt;br&gt;        schedule_col_idx = &lt;span style=&quot;color:#6897bb;&quot;&gt;1&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;color:#6897bb;&quot;&gt;        &lt;/span&gt;&lt;span style=&quot;color:#cc7832;&quot;&gt;for &lt;/span&gt;base_info_filed &lt;span style=&quot;color:#cc7832;&quot;&gt;in &lt;/span&gt;employee_base_info:&lt;br&gt;            dst_sheet.cell(schedule_row_idx&lt;span style=&quot;color:#cc7832;&quot;&gt;, &lt;/span&gt;schedule_col_idx).value = schedule[base_info_filed]&lt;br&gt;            dst_sheet.cell(schedule_row_idx&lt;span style=&quot;color:#cc7832;&quot;&gt;, &lt;/span&gt;schedule_col_idx).fill = copy(blue_fill)&lt;br&gt;            schedule_col_idx = schedule_col_idx + &lt;span style=&quot;color:#6897bb;&quot;&gt;1&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;color:#6897bb;&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;color:#6897bb;&quot;&gt;        &lt;/span&gt;shift_total_hours = &lt;span style=&quot;color:#6897bb;&quot;&gt;0&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;color:#6897bb;&quot;&gt;        &lt;/span&gt;total_working_hours = &lt;span style=&quot;color:#6897bb;&quot;&gt;0&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;color:#6897bb;&quot;&gt;        &lt;/span&gt;&lt;span style=&quot;color:#cc7832;&quot;&gt;for &lt;/span&gt;shift &lt;span style=&quot;color:#cc7832;&quot;&gt;in &lt;/span&gt;schedule[&lt;span style=&quot;color:#6a8759;&quot;&gt;&#39;shift_list&#39;&lt;/span&gt;]:&lt;br&gt;            shift_date = shift[&lt;span style=&quot;color:#6a8759;&quot;&gt;&#39;datetime&#39;&lt;/span&gt;]&lt;br&gt;            shift_hours = shift[&lt;span style=&quot;color:#6a8759;&quot;&gt;&#39;shift_hours&#39;&lt;/span&gt;]&lt;br&gt;            working_hours = shift[&lt;span style=&quot;color:#6a8759;&quot;&gt;&#39;working_hours&#39;&lt;/span&gt;][&lt;span style=&quot;color:#6897bb;&quot;&gt;2&lt;/span&gt;]&lt;br&gt;&lt;br&gt;            shift_cell = dst_sheet.cell(schedule_row_idx&lt;span style=&quot;color:#cc7832;&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;color:#8888c6;&quot;&gt;len&lt;/span&gt;(employee_base_info) + shift_date.day)&lt;br&gt;            shift_cell.value = &lt;span style=&quot;color:#6a8759;&quot;&gt;&quot;%s/%.f&quot; &lt;/span&gt;% (shift[&lt;span style=&quot;color:#6a8759;&quot;&gt;&#39;shift_type&#39;&lt;/span&gt;].name&lt;span style=&quot;color:#cc7832;&quot;&gt;, &lt;/span&gt;working_hours)&lt;br&gt;&lt;br&gt;            &lt;span style=&quot;color:#cc7832;&quot;&gt;if &lt;/span&gt;shift_hours != working_hours:&lt;br&gt;                shift_cell.fill = PatternFill(&lt;span style=&quot;color:#aa4926;&quot;&gt;fill_type&lt;/span&gt;=&lt;span style=&quot;color:#6a8759;&quot;&gt;&#39;solid&#39;&lt;/span&gt;&lt;span style=&quot;color:#cc7832;&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;color:#aa4926;&quot;&gt;fgColor&lt;/span&gt;=&lt;span style=&quot;color:#6a8759;&quot;&gt;&#39;ffff00&#39;&lt;/span&gt;)&lt;br&gt;                &lt;span style=&quot;color:#cc7832;&quot;&gt;if &lt;/span&gt;working_hours &amp;lt; &lt;span style=&quot;color:#6897bb;&quot;&gt;3&lt;/span&gt;:&lt;br&gt;                    shift_cell.fill = PatternFill(&lt;span style=&quot;color:#aa4926;&quot;&gt;fill_type&lt;/span&gt;=&lt;span style=&quot;color:#6a8759;&quot;&gt;&#39;solid&#39;&lt;/span&gt;&lt;span style=&quot;color:#cc7832;&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;color:#aa4926;&quot;&gt;fgColor&lt;/span&gt;=&lt;span style=&quot;color:#6a8759;&quot;&gt;&#39;9c0006&#39;&lt;/span&gt;)&lt;br&gt;&lt;br&gt;            shift_total_hours = shift_total_hours + shift_hours&lt;br&gt;            total_working_hours = total_working_hours + working_hours&lt;br&gt;&lt;br&gt;        dst_sheet.cell(schedule_row_idx&lt;span style=&quot;color:#cc7832;&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;color:#6897bb;&quot;&gt;37&lt;/span&gt;).value = shift_total_hours&lt;br&gt;        dst_sheet.cell(schedule_row_idx&lt;span style=&quot;color:#cc7832;&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;color:#6897bb;&quot;&gt;37&lt;/span&gt;).fill = copy(blue_fill)&lt;br&gt;        dst_sheet.cell(schedule_row_idx&lt;span style=&quot;color:#cc7832;&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;color:#6897bb;&quot;&gt;38&lt;/span&gt;).value = total_working_hours&lt;br&gt;        dst_sheet.cell(schedule_row_idx&lt;span style=&quot;color:#cc7832;&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;color:#6897bb;&quot;&gt;39&lt;/span&gt;).value = total_working_hours - shift_total_hours&lt;br&gt;&lt;br&gt;        copy_row_style(&lt;span style=&quot;color:#6897bb;&quot;&gt;6&lt;/span&gt;&lt;span style=&quot;color:#cc7832;&quot;&gt;, &lt;/span&gt;schedule_row_idx&lt;span style=&quot;color:#cc7832;&quot;&gt;, True&lt;/span&gt;)&lt;br&gt;        schedule_row_idx = schedule_row_idx + &lt;span style=&quot;color:#6897bb;&quot;&gt;1&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;color:#6897bb;&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;color:#6897bb;&quot;&gt;    &lt;/span&gt;&lt;span style=&quot;color:#cc7832;&quot;&gt;def &lt;/span&gt;&lt;span style=&quot;color:#ffc66d;&quot;&gt;add_map_value&lt;/span&gt;(m&lt;span style=&quot;color:#cc7832;&quot;&gt;, &lt;/span&gt;key&lt;span style=&quot;color:#cc7832;&quot;&gt;, &lt;/span&gt;value):&lt;br&gt;        &lt;span style=&quot;color:#cc7832;&quot;&gt;if &lt;/span&gt;key &lt;span style=&quot;color:#cc7832;&quot;&gt;not in &lt;/span&gt;m:&lt;br&gt;            m[key] = value&lt;br&gt;        &lt;span style=&quot;color:#cc7832;&quot;&gt;else&lt;/span&gt;:&lt;br&gt;            m[key] = m[key] + value&lt;br&gt;&lt;br&gt;    &lt;span style=&quot;color:#808080;&quot;&gt;# &lt;/span&gt;&lt;span style=&quot;color:#808080;font-family:&#39;宋体&#39;,monospace;&quot;&gt;排班统计表&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;color:#808080;font-family:&#39;宋体&#39;,monospace;&quot;&gt;    &lt;/span&gt;&lt;span style=&quot;color:#cc7832;&quot;&gt;def &lt;/span&gt;&lt;span style=&quot;color:#ffc66d;&quot;&gt;set_sum_cell_format1&lt;/span&gt;(cell):&lt;br&gt;        cell.fill = blue_fill&lt;br&gt;        cell.alignment = Alignment(&lt;span style=&quot;color:#aa4926;&quot;&gt;horizontal&lt;/span&gt;=&lt;span style=&quot;color:#6a8759;&quot;&gt;&#39;center&#39;&lt;/span&gt;)&lt;br&gt;&lt;br&gt;    shift_sum_row_idx = schedule_row_idx + &lt;span style=&quot;color:#6897bb;&quot;&gt;1&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;color:#6897bb;&quot;&gt;    &lt;/span&gt;dst_sheet.cell(shift_sum_row_idx&lt;span style=&quot;color:#cc7832;&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;color:#6897bb;&quot;&gt;1&lt;/span&gt;).value = &lt;span style=&quot;color:#6a8759;&quot;&gt;&#39;&lt;/span&gt;&lt;span style=&quot;color:#6a8759;font-family:&#39;宋体&#39;,monospace;&quot;&gt;正常排班日小时统计&lt;/span&gt;&lt;span style=&quot;color:#6a8759;&quot;&gt;&#39;&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;color:#6a8759;&quot;&gt;    &lt;/span&gt;dst_sheet.cell(shift_sum_row_idx + &lt;span style=&quot;color:#6897bb;&quot;&gt;1&lt;/span&gt;&lt;span style=&quot;color:#cc7832;&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;color:#6897bb;&quot;&gt;1&lt;/span&gt;).value = &lt;span style=&quot;color:#6a8759;&quot;&gt;&#39;&lt;/span&gt;&lt;span style=&quot;color:#6a8759;font-family:&#39;宋体&#39;,monospace;&quot;&gt;正常班白班人数统计&lt;/span&gt;&lt;span style=&quot;color:#6a8759;&quot;&gt;&#39;&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;color:#6a8759;&quot;&gt;    &lt;/span&gt;dst_sheet.cell(shift_sum_row_idx + &lt;span style=&quot;color:#6897bb;&quot;&gt;2&lt;/span&gt;&lt;span style=&quot;color:#cc7832;&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;color:#6897bb;&quot;&gt;1&lt;/span&gt;).value = &lt;span style=&quot;color:#6a8759;&quot;&gt;&#39;&lt;/span&gt;&lt;span style=&quot;color:#6a8759;font-family:&#39;宋体&#39;,monospace;&quot;&gt;正常班夜班人数统计&lt;/span&gt;&lt;span style=&quot;color:#6a8759;&quot;&gt;&#39;&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;color:#6a8759;&quot;&gt;    &lt;/span&gt;&lt;span style=&quot;color:#cc7832;&quot;&gt;for &lt;/span&gt;i &lt;span style=&quot;color:#cc7832;&quot;&gt;in &lt;/span&gt;&lt;span style=&quot;color:#8888c6;&quot;&gt;range&lt;/span&gt;(&lt;span style=&quot;color:#6897bb;&quot;&gt;0&lt;/span&gt;&lt;span style=&quot;color:#cc7832;&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;color:#6897bb;&quot;&gt;3&lt;/span&gt;):&lt;br&gt;        set_sum_cell_format1(dst_sheet.cell(shift_sum_row_idx + i&lt;span style=&quot;color:#cc7832;&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;color:#6897bb;&quot;&gt;1&lt;/span&gt;))&lt;br&gt;        set_sum_cell_format1(dst_sheet.cell(shift_sum_row_idx + i&lt;span style=&quot;color:#cc7832;&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;color:#6897bb;&quot;&gt;37&lt;/span&gt;))&lt;br&gt;    dst_sheet.merge_cells(&lt;span style=&quot;color:#6a8759;&quot;&gt;&quot;A%d:E%d&quot; &lt;/span&gt;% (shift_sum_row_idx&lt;span style=&quot;color:#cc7832;&quot;&gt;, &lt;/span&gt;shift_sum_row_idx))&lt;br&gt;    dst_sheet.merge_cells(&lt;span style=&quot;color:#6a8759;&quot;&gt;&quot;A%d:E%d&quot; &lt;/span&gt;% (shift_sum_row_idx + &lt;span style=&quot;color:#6897bb;&quot;&gt;1&lt;/span&gt;&lt;span style=&quot;color:#cc7832;&quot;&gt;, &lt;/span&gt;shift_sum_row_idx + &lt;span style=&quot;color:#6897bb;&quot;&gt;1&lt;/span&gt;))&lt;br&gt;    dst_sheet.merge_cells(&lt;span style=&quot;color:#6a8759;&quot;&gt;&quot;A%d:E%d&quot; &lt;/span&gt;% (shift_sum_row_idx + &lt;span style=&quot;color:#6897bb;&quot;&gt;2&lt;/span&gt;&lt;span style=&quot;color:#cc7832;&quot;&gt;, &lt;/span&gt;shift_sum_row_idx + &lt;span style=&quot;color:#6897bb;&quot;&gt;2&lt;/span&gt;))&lt;br&gt;&lt;br&gt;    shift_sum_daily_hours = {}&lt;br&gt;    shift_sum_daily_daytime = {}&lt;br&gt;    shift_sum_daily_night = {}&lt;br&gt;    &lt;span style=&quot;color:#cc7832;&quot;&gt;for &lt;/span&gt;schedule &lt;span style=&quot;color:#cc7832;&quot;&gt;in &lt;/span&gt;shift_roaster_data:&lt;br&gt;        &lt;span style=&quot;color:#cc7832;&quot;&gt;for &lt;/span&gt;shift &lt;span style=&quot;color:#cc7832;&quot;&gt;in &lt;/span&gt;schedule[&lt;span style=&quot;color:#6a8759;&quot;&gt;&#39;shift_list&#39;&lt;/span&gt;]:&lt;br&gt;            shift_day = shift[&lt;span style=&quot;color:#6a8759;&quot;&gt;&#39;datetime&#39;&lt;/span&gt;].day&lt;br&gt;            shift_hours = shift[&lt;span style=&quot;color:#6a8759;&quot;&gt;&#39;shift_hours&#39;&lt;/span&gt;]&lt;br&gt;            shift_type = shift[&lt;span style=&quot;color:#6a8759;&quot;&gt;&#39;shift_type&#39;&lt;/span&gt;]&lt;br&gt;            add_map_value(shift_sum_daily_hours&lt;span style=&quot;color:#cc7832;&quot;&gt;, &lt;/span&gt;shift_day&lt;span style=&quot;color:#cc7832;&quot;&gt;, &lt;/span&gt;shift_hours)&lt;br&gt;            &lt;span style=&quot;color:#cc7832;&quot;&gt;if &lt;/span&gt;shift_type.value[&lt;span style=&quot;color:#6897bb;&quot;&gt;2&lt;/span&gt;] == &lt;span style=&quot;color:#6897bb;&quot;&gt;0&lt;/span&gt;:&lt;br&gt;                add_map_value(shift_sum_daily_daytime&lt;span style=&quot;color:#cc7832;&quot;&gt;, &lt;/span&gt;shift_day&lt;span style=&quot;color:#cc7832;&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;color:#6897bb;&quot;&gt;1&lt;/span&gt;)&lt;br&gt;            &lt;span style=&quot;color:#cc7832;&quot;&gt;elif &lt;/span&gt;shift_type.value[&lt;span style=&quot;color:#6897bb;&quot;&gt;2&lt;/span&gt;] == &lt;span style=&quot;color:#6897bb;&quot;&gt;1&lt;/span&gt;:&lt;br&gt;                add_map_value(shift_sum_daily_night&lt;span style=&quot;color:#cc7832;&quot;&gt;, &lt;/span&gt;shift_day&lt;span style=&quot;color:#cc7832;&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;color:#6897bb;&quot;&gt;1&lt;/span&gt;)&lt;br&gt;&lt;br&gt;    shift_sum_daily_hours_total = &lt;span style=&quot;color:#6897bb;&quot;&gt;0&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;color:#6897bb;&quot;&gt;    &lt;/span&gt;&lt;span style=&quot;color:#cc7832;&quot;&gt;for &lt;/span&gt;d &lt;span style=&quot;color:#cc7832;&quot;&gt;in &lt;/span&gt;&lt;span style=&quot;color:#8888c6;&quot;&gt;range&lt;/span&gt;(&lt;span style=&quot;color:#6897bb;&quot;&gt;1&lt;/span&gt;&lt;span style=&quot;color:#cc7832;&quot;&gt;, &lt;/span&gt;days + &lt;span style=&quot;color:#6897bb;&quot;&gt;1&lt;/span&gt;):&lt;br&gt;        hours_sum = shift_sum_daily_hours[d] &lt;span style=&quot;color:#cc7832;&quot;&gt;if &lt;/span&gt;d &lt;span style=&quot;color:#cc7832;&quot;&gt;in &lt;/span&gt;shift_sum_daily_hours &lt;span style=&quot;color:#cc7832;&quot;&gt;else &lt;/span&gt;&lt;span style=&quot;color:#6897bb;&quot;&gt;0&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;color:#6897bb;&quot;&gt;        &lt;/span&gt;daytime_sum = shift_sum_daily_daytime[d] &lt;span style=&quot;color:#cc7832;&quot;&gt;if &lt;/span&gt;d &lt;span style=&quot;color:#cc7832;&quot;&gt;in &lt;/span&gt;shift_sum_daily_daytime &lt;span style=&quot;color:#cc7832;&quot;&gt;else &lt;/span&gt;&lt;span style=&quot;color:#6897bb;&quot;&gt;0&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;color:#6897bb;&quot;&gt;        &lt;/span&gt;night_sum = shift_sum_daily_night[d] &lt;span style=&quot;color:#cc7832;&quot;&gt;if &lt;/span&gt;d &lt;span style=&quot;color:#cc7832;&quot;&gt;in &lt;/span&gt;shift_sum_daily_night &lt;span style=&quot;color:#cc7832;&quot;&gt;else &lt;/span&gt;&lt;span style=&quot;color:#6897bb;&quot;&gt;0&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;color:#6897bb;&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;color:#6897bb;&quot;&gt;        &lt;/span&gt;dst_sheet.cell(shift_sum_row_idx&lt;span style=&quot;color:#cc7832;&quot;&gt;, &lt;/span&gt;d + &lt;span style=&quot;color:#8888c6;&quot;&gt;len&lt;/span&gt;(employee_base_info)).value = hours_sum&lt;br&gt;        dst_sheet.cell(shift_sum_row_idx + &lt;span style=&quot;color:#6897bb;&quot;&gt;1&lt;/span&gt;&lt;span style=&quot;color:#cc7832;&quot;&gt;, &lt;/span&gt;d + &lt;span style=&quot;color:#8888c6;&quot;&gt;len&lt;/span&gt;(employee_base_info)).value = daytime_sum&lt;br&gt;        dst_sheet.cell(shift_sum_row_idx + &lt;span style=&quot;color:#6897bb;&quot;&gt;2&lt;/span&gt;&lt;span style=&quot;color:#cc7832;&quot;&gt;, &lt;/span&gt;d + &lt;span style=&quot;color:#8888c6;&quot;&gt;len&lt;/span&gt;(employee_base_info)).value = night_sum&lt;br&gt;&lt;br&gt;        shift_sum_daily_hours_total = shift_sum_daily_hours_total + hours_sum&lt;br&gt;    dst_sheet.cell(shift_sum_row_idx&lt;span style=&quot;color:#cc7832;&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;color:#6897bb;&quot;&gt;37&lt;/span&gt;).value = shift_sum_daily_hours_total&lt;br&gt;&lt;br&gt;    &lt;span style=&quot;color:#808080;&quot;&gt;# &lt;/span&gt;&lt;span style=&quot;color:#808080;font-family:&#39;宋体&#39;,monospace;&quot;&gt;打卡统计表&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;color:#808080;font-family:&#39;宋体&#39;,monospace;&quot;&gt;    &lt;/span&gt;&lt;span style=&quot;color:#cc7832;&quot;&gt;def &lt;/span&gt;&lt;span style=&quot;color:#ffc66d;&quot;&gt;set_sum_cell_format2&lt;/span&gt;(cell):&lt;br&gt;        cell.fill = yellow_fill&lt;br&gt;        cell.alignment = Alignment(&lt;span style=&quot;color:#aa4926;&quot;&gt;horizontal&lt;/span&gt;=&lt;span style=&quot;color:#6a8759;&quot;&gt;&#39;center&#39;&lt;/span&gt;)&lt;br&gt;&lt;br&gt;    shift_sum_row_idx = shift_sum_row_idx + &lt;span style=&quot;color:#6897bb;&quot;&gt;4&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;color:#6897bb;&quot;&gt;    &lt;/span&gt;dst_sheet.cell(shift_sum_row_idx&lt;span style=&quot;color:#cc7832;&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;color:#6897bb;&quot;&gt;1&lt;/span&gt;).value = &lt;span style=&quot;color:#6a8759;&quot;&gt;&#39;&lt;/span&gt;&lt;span style=&quot;color:#6a8759;font-family:&#39;宋体&#39;,monospace;&quot;&gt;正常排班日小时统计&lt;/span&gt;&lt;span style=&quot;color:#6a8759;&quot;&gt; (Badge Data)&#39;&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;color:#6a8759;&quot;&gt;    &lt;/span&gt;dst_sheet.cell(shift_sum_row_idx + &lt;span style=&quot;color:#6897bb;&quot;&gt;1&lt;/span&gt;&lt;span style=&quot;color:#cc7832;&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;color:#6897bb;&quot;&gt;1&lt;/span&gt;).value = &lt;span style=&quot;color:#6a8759;&quot;&gt;&#39;&lt;/span&gt;&lt;span style=&quot;color:#6a8759;font-family:&#39;宋体&#39;,monospace;&quot;&gt;正常班白班人数统计&lt;/span&gt;&lt;span style=&quot;color:#6a8759;&quot;&gt; (Badge Data)&#39;&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;color:#6a8759;&quot;&gt;    &lt;/span&gt;dst_sheet.cell(shift_sum_row_idx + &lt;span style=&quot;color:#6897bb;&quot;&gt;2&lt;/span&gt;&lt;span style=&quot;color:#cc7832;&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;color:#6897bb;&quot;&gt;1&lt;/span&gt;).value = &lt;span style=&quot;color:#6a8759;&quot;&gt;&#39;&lt;/span&gt;&lt;span style=&quot;color:#6a8759;font-family:&#39;宋体&#39;,monospace;&quot;&gt;正常班夜班人数统计&lt;/span&gt;&lt;span style=&quot;color:#6a8759;&quot;&gt; (Badge Data)&#39;&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;color:#6a8759;&quot;&gt;    &lt;/span&gt;&lt;span style=&quot;color:#cc7832;&quot;&gt;for &lt;/span&gt;i &lt;span style=&quot;color:#cc7832;&quot;&gt;in &lt;/span&gt;&lt;span style=&quot;color:#8888c6;&quot;&gt;range&lt;/span&gt;(&lt;span style=&quot;color:#6897bb;&quot;&gt;0&lt;/span&gt;&lt;span style=&quot;color:#cc7832;&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;color:#6897bb;&quot;&gt;3&lt;/span&gt;):&lt;br&gt;        set_sum_cell_format2(dst_sheet.cell(shift_sum_row_idx + i&lt;span style=&quot;color:#cc7832;&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;color:#6897bb;&quot;&gt;1&lt;/span&gt;))&lt;br&gt;        set_sum_cell_format2(dst_sheet.cell(shift_sum_row_idx + i&lt;span style=&quot;color:#cc7832;&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;color:#6897bb;&quot;&gt;37&lt;/span&gt;))&lt;br&gt;    dst_sheet.merge_cells(&lt;span style=&quot;color:#6a8759;&quot;&gt;&quot;A%d:E%d&quot; &lt;/span&gt;% (shift_sum_row_idx&lt;span style=&quot;color:#cc7832;&quot;&gt;, &lt;/span&gt;shift_sum_row_idx))&lt;br&gt;    dst_sheet.merge_cells(&lt;span style=&quot;color:#6a8759;&quot;&gt;&quot;A%d:E%d&quot; &lt;/span&gt;% (shift_sum_row_idx + &lt;span style=&quot;color:#6897bb;&quot;&gt;1&lt;/span&gt;&lt;span style=&quot;color:#cc7832;&quot;&gt;, &lt;/span&gt;shift_sum_row_idx + &lt;span style=&quot;color:#6897bb;&quot;&gt;1&lt;/span&gt;))&lt;br&gt;    dst_sheet.merge_cells(&lt;span style=&quot;color:#6a8759;&quot;&gt;&quot;A%d:E%d&quot; &lt;/span&gt;% (shift_sum_row_idx + &lt;span style=&quot;color:#6897bb;&quot;&gt;2&lt;/span&gt;&lt;span style=&quot;color:#cc7832;&quot;&gt;, &lt;/span&gt;shift_sum_row_idx + &lt;span style=&quot;color:#6897bb;&quot;&gt;2&lt;/span&gt;))&lt;br&gt;&lt;br&gt;    shift_sum_daily_hours = {}&lt;br&gt;    shift_sum_daily_daytime = {}&lt;br&gt;    shift_sum_daily_night = {}&lt;br&gt;    &lt;span style=&quot;color:#cc7832;&quot;&gt;for &lt;/span&gt;schedule &lt;span style=&quot;color:#cc7832;&quot;&gt;in &lt;/span&gt;shift_roaster_data:&lt;br&gt;        &lt;span style=&quot;color:#cc7832;&quot;&gt;for &lt;/span&gt;shift &lt;span style=&quot;color:#cc7832;&quot;&gt;in &lt;/span&gt;schedule[&lt;span style=&quot;color:#6a8759;&quot;&gt;&#39;shift_list&#39;&lt;/span&gt;]:&lt;br&gt;            shift_day = shift[&lt;span style=&quot;color:#6a8759;&quot;&gt;&#39;datetime&#39;&lt;/span&gt;].day&lt;br&gt;            working_hours = shift[&lt;span style=&quot;color:#6a8759;&quot;&gt;&#39;working_hours&#39;&lt;/span&gt;][&lt;span style=&quot;color:#6897bb;&quot;&gt;2&lt;/span&gt;]&lt;br&gt;            shift_type = shift[&lt;span style=&quot;color:#6a8759;&quot;&gt;&#39;shift_type&#39;&lt;/span&gt;]&lt;br&gt;            add_map_value(shift_sum_daily_hours&lt;span style=&quot;color:#cc7832;&quot;&gt;, &lt;/span&gt;shift_day&lt;span style=&quot;color:#cc7832;&quot;&gt;, &lt;/span&gt;working_hours)&lt;br&gt;            &lt;span style=&quot;color:#cc7832;&quot;&gt;if &lt;/span&gt;shift_type.value[&lt;span style=&quot;color:#6897bb;&quot;&gt;2&lt;/span&gt;] == &lt;span style=&quot;color:#6897bb;&quot;&gt;0&lt;/span&gt;:&lt;br&gt;                add_map_value(shift_sum_daily_daytime&lt;span style=&quot;color:#cc7832;&quot;&gt;, &lt;/span&gt;shift_day&lt;span style=&quot;color:#cc7832;&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;color:#6897bb;&quot;&gt;1 &lt;/span&gt;&lt;span style=&quot;color:#cc7832;&quot;&gt;if &lt;/span&gt;working_hours &amp;gt; &lt;span style=&quot;color:#6897bb;&quot;&gt;0 &lt;/span&gt;&lt;span style=&quot;color:#cc7832;&quot;&gt;else &lt;/span&gt;&lt;span style=&quot;color:#6897bb;&quot;&gt;0&lt;/span&gt;)&lt;br&gt;            &lt;span style=&quot;color:#cc7832;&quot;&gt;elif &lt;/span&gt;shift_type.value[&lt;span style=&quot;color:#6897bb;&quot;&gt;2&lt;/span&gt;] == &lt;span style=&quot;color:#6897bb;&quot;&gt;1&lt;/span&gt;:&lt;br&gt;                add_map_value(shift_sum_daily_night&lt;span style=&quot;color:#cc7832;&quot;&gt;, &lt;/span&gt;shift_day&lt;span style=&quot;color:#cc7832;&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;color:#6897bb;&quot;&gt;1 &lt;/span&gt;&lt;span style=&quot;color:#cc7832;&quot;&gt;if &lt;/span&gt;working_hours &amp;gt; &lt;span style=&quot;color:#6897bb;&quot;&gt;0 &lt;/span&gt;&lt;span style=&quot;color:#cc7832;&quot;&gt;else &lt;/span&gt;&lt;span style=&quot;color:#6897bb;&quot;&gt;0&lt;/span&gt;)&lt;br&gt;&lt;br&gt;    shift_sum_daily_hours_total = &lt;span style=&quot;color:#6897bb;&quot;&gt;0&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;color:#6897bb;&quot;&gt;    &lt;/span&gt;&lt;span style=&quot;color:#cc7832;&quot;&gt;for &lt;/span&gt;d &lt;span style=&quot;color:#cc7832;&quot;&gt;in &lt;/span&gt;&lt;span style=&quot;color:#8888c6;&quot;&gt;range&lt;/span&gt;(&lt;span style=&quot;color:#6897bb;&quot;&gt;1&lt;/span&gt;&lt;span style=&quot;color:#cc7832;&quot;&gt;, &lt;/span&gt;days + &lt;span style=&quot;color:#6897bb;&quot;&gt;1&lt;/span&gt;):&lt;br&gt;        hours_sum = shift_sum_daily_hours[d] &lt;span style=&quot;color:#cc7832;&quot;&gt;if &lt;/span&gt;d &lt;span style=&quot;color:#cc7832;&quot;&gt;in &lt;/span&gt;shift_sum_daily_hours &lt;span style=&quot;color:#cc7832;&quot;&gt;else &lt;/span&gt;&lt;span style=&quot;color:#6897bb;&quot;&gt;0&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;color:#6897bb;&quot;&gt;        &lt;/span&gt;daytime_sum = shift_sum_daily_daytime[d] &lt;span style=&quot;color:#cc7832;&quot;&gt;if &lt;/span&gt;d &lt;span style=&quot;color:#cc7832;&quot;&gt;in &lt;/span&gt;shift_sum_daily_daytime &lt;span style=&quot;color:#cc7832;&quot;&gt;else &lt;/span&gt;&lt;span style=&quot;color:#6897bb;&quot;&gt;0&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;color:#6897bb;&quot;&gt;        &lt;/span&gt;night_sum = shift_sum_daily_night[d] &lt;span style=&quot;color:#cc7832;&quot;&gt;if &lt;/span&gt;d &lt;span style=&quot;color:#cc7832;&quot;&gt;in &lt;/span&gt;shift_sum_daily_night &lt;span style=&quot;color:#cc7832;&quot;&gt;else &lt;/span&gt;&lt;span style=&quot;color:#6897bb;&quot;&gt;0&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;color:#6897bb;&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;color:#6897bb;&quot;&gt;        &lt;/span&gt;dst_sheet.cell(shift_sum_row_idx&lt;span style=&quot;color:#cc7832;&quot;&gt;, &lt;/span&gt;d + &lt;span style=&quot;color:#8888c6;&quot;&gt;len&lt;/span&gt;(employee_base_info)).value = hours_sum&lt;br&gt;        dst_sheet.cell(shift_sum_row_idx + &lt;span style=&quot;color:#6897bb;&quot;&gt;1&lt;/span&gt;&lt;span style=&quot;color:#cc7832;&quot;&gt;, &lt;/span&gt;d + &lt;span style=&quot;color:#8888c6;&quot;&gt;len&lt;/span&gt;(employee_base_info)).value = daytime_sum&lt;br&gt;        dst_sheet.cell(shift_sum_row_idx + &lt;span style=&quot;color:#6897bb;&quot;&gt;2&lt;/span&gt;&lt;span style=&quot;color:#cc7832;&quot;&gt;, &lt;/span&gt;d + &lt;span style=&quot;color:#8888c6;&quot;&gt;len&lt;/span&gt;(employee_base_info)).value = night_sum&lt;br&gt;&lt;br&gt;        shift_sum_daily_hours_total = shift_sum_daily_hours_total + hours_sum&lt;br&gt;    dst_sheet.cell(shift_sum_row_idx&lt;span style=&quot;color:#cc7832;&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;color:#6897bb;&quot;&gt;37&lt;/span&gt;).value = shift_sum_daily_hours_total&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;span style=&quot;color:#cc7832;&quot;&gt;def &lt;/span&gt;&lt;span style=&quot;color:#ffc66d;&quot;&gt;generate_validated_shift_roster&lt;/span&gt;(shift_roaster_file&lt;span style=&quot;color:#cc7832;&quot;&gt;, &lt;/span&gt;sheets&lt;span style=&quot;color:#cc7832;&quot;&gt;, &lt;/span&gt;badge_scan_file&lt;span style=&quot;color:#cc7832;&quot;&gt;, &lt;/span&gt;save_path_supplier=&lt;span style=&quot;color:#cc7832;&quot;&gt;None&lt;/span&gt;):&lt;br&gt;    src_wb = load_workbook(shift_roaster_file&lt;span style=&quot;color:#cc7832;&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;color:#aa4926;&quot;&gt;data_only&lt;/span&gt;=&lt;span style=&quot;color:#cc7832;&quot;&gt;True&lt;/span&gt;)&lt;br&gt;    dst_wb = load_workbook(resource_path(&lt;span style=&quot;color:#6a8759;&quot;&gt;&#39;res/template.xlsx&#39;&lt;/span&gt;)&lt;span style=&quot;color:#cc7832;&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;color:#aa4926;&quot;&gt;data_only&lt;/span&gt;=&lt;span style=&quot;color:#cc7832;&quot;&gt;True&lt;/span&gt;)&lt;br&gt;&lt;br&gt;    &lt;span style=&quot;color:#cc7832;&quot;&gt;for &lt;/span&gt;shift_roaster_sheet &lt;span style=&quot;color:#cc7832;&quot;&gt;in &lt;/span&gt;sheets:&lt;br&gt;        shift_roaster_data = load_shift_roaster_data(shift_roaster_file&lt;span style=&quot;color:#cc7832;&quot;&gt;, &lt;/span&gt;shift_roaster_sheet)&lt;br&gt;        badge_scan_data = load_badge_scan_data(badge_scan_file)&lt;br&gt;        cal_working_hours(shift_roaster_data&lt;span style=&quot;color:#cc7832;&quot;&gt;, &lt;/span&gt;badge_scan_data)&lt;br&gt;&lt;br&gt;        src_sheet = src_wb[shift_roaster_sheet]&lt;br&gt;        dst_sheet = dst_wb.copy_worksheet(dst_wb[&lt;span style=&quot;color:#6a8759;&quot;&gt;&#39;tpl&#39;&lt;/span&gt;])&lt;br&gt;        dst_sheet.title = shift_roaster_sheet&lt;br&gt;        generate_validated_sheet(src_wb&lt;span style=&quot;color:#cc7832;&quot;&gt;, &lt;/span&gt;src_sheet&lt;span style=&quot;color:#cc7832;&quot;&gt;, &lt;/span&gt;dst_sheet&lt;span style=&quot;color:#cc7832;&quot;&gt;, &lt;/span&gt;shift_roaster_data)&lt;br&gt;&lt;br&gt;    &lt;span style=&quot;color:#cc7832;&quot;&gt;del &lt;/span&gt;dst_wb[&lt;span style=&quot;color:#6a8759;&quot;&gt;&#39;tpl&#39;&lt;/span&gt;]&lt;br&gt;    save_base_name = &lt;span style=&quot;color:#6a8759;&quot;&gt;&#39;validated_&#39; &lt;/span&gt;+ os.path.basename(shift_roaster_file).replace(&lt;span style=&quot;color:#6a8759;&quot;&gt;&#39;xlsm&#39;&lt;/span&gt;&lt;span style=&quot;color:#cc7832;&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;color:#6a8759;&quot;&gt;&#39;xlsx&#39;&lt;/span&gt;)&lt;br&gt;    &lt;span style=&quot;color:#cc7832;&quot;&gt;if &lt;/span&gt;save_path_supplier &lt;span style=&quot;color:#cc7832;&quot;&gt;is None&lt;/span&gt;:&lt;br&gt;        dst_wb.save(os.path.join(os.path.abspath(&lt;span style=&quot;color:#6a8759;&quot;&gt;&#39;.&#39;&lt;/span&gt;)&lt;span style=&quot;color:#cc7832;&quot;&gt;, &lt;/span&gt;save_base_name))&lt;br&gt;    &lt;span style=&quot;color:#cc7832;&quot;&gt;else&lt;/span&gt;:&lt;br&gt;        dst_wb.save(os.path.join(save_path_supplier()))&lt;br&gt;&lt;br&gt;    dst_wb.close()&lt;br&gt;    src_wb.close()&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;span style=&quot;color:#cc7832;&quot;&gt;if &lt;/span&gt;__name__ == &lt;span style=&quot;color:#6a8759;&quot;&gt;&#39;__main__&#39;&lt;/span&gt;:&lt;br&gt;    generate_validated_shift_roster(&lt;span style=&quot;color:#6a8759;&quot;&gt;&#39;input1.xlsm&#39;&lt;/span&gt;&lt;span style=&quot;color:#cc7832;&quot;&gt;, &lt;/span&gt;[&lt;span style=&quot;color:#6a8759;&quot;&gt;&#39;SZX3&#39;&lt;/span&gt;]&lt;span style=&quot;color:#cc7832;&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;color:#6a8759;&quot;&gt;&#39;input2.xlsx&#39;&lt;/span&gt;)&lt;br&gt;&lt;/pre&gt;&lt;/div&gt;" style="text;html=1;strokeColor=none;fillColor=none;spacing=5;spacingTop=-20;whiteSpace=wrap;overflow=hidden;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="320" y="350" width="900" height="3410" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
